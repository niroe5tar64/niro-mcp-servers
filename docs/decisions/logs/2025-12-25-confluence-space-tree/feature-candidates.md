---
date: 2025-12-25
topic: confluence-content機能追加候補一覧
note: 今回は「スペースツリー取得」を優先。以下は将来の参考用。
---

# 機能追加候補一覧

## 他のLLMからの提案

| 機能 | 概要 | 効果 | コスト |
|------|------|------|--------|
| 検索ツール追加 | CQL/キーワード/スペース/ラベルで候補ページ一覧。LLMが「どこを見るべきか」を自力で決められる | 高 | 中 |
| ページツリー取得 | スペース配下の階層を辿ってまとめてMarkdown化。オンボーディングや設計書セットに強い | 高 | 中 |
| 増分同期 | 更新日時で差分取得。日次/週次のナレッジ更新に便利 | 高 | 中 |
| リンク解決/内部参照の強化 | 内部リンクをタイトル/URLに正規化、相対リンク崩れを抑える | 中 | 中 |
| 添付ファイル/画像の扱い | 添付一覧・MIME・サイズ・URL、必要なら本文中にプレースホルダ挿入 | 中 | 中 |
| セクション抽出/制限 | 見出し指定で部分抽出、最大トークン制限、重要度の高いセクション優先 | 中 | 低 |
| 出力のメタ情報強化 | Frontmatterに spaceKey/labels/lastUpdated/version/author など追加 | 中 | 低 |
| マクロ拡張 | expand/children/excerpt/includeなどの主要マクロ対応を増やす | 中 | 中 |
| キャッシュ/ETag対応 | 同一ページの再取得を抑え、体感速度を上げる | 中 | 中 |

## 壁打ちで追加提案した機能

| 機能 | 概要 | ユースケース |
|------|------|-------------|
| コメント取得 | ページに紐づくコメント一覧を取得 | レビュー履歴や議論の把握 |
| バージョン履歴/差分 | 特定バージョン取得、または2バージョン間の差分 | 変更追跡、ロールバック判断 |
| ページ作成/更新 | Markdownを入力してConfluenceページを作成・更新 | 双方向同期、ドキュメント自動生成 |
| スペース情報取得 | スペース一覧、スペースのメタ情報 | 「どのスペースを見るべきか」の判断材料 |
| ラベル操作 | ラベル一覧取得、ラベル付与/削除 | 分類整理、検索性向上 |
| ウォッチャー管理 | ページのウォッチャー一覧、ウォッチ登録 | 関係者把握、通知管理 |
| 制限/権限確認 | ページの閲覧・編集権限を確認 | アクセス可否の事前判断 |
| テンプレート取得 | スペースのテンプレート一覧と内容取得 | 新規ページ作成時の参考 |
| 関連ページ取得 | 「このページを見ている人は〜」的なリンク | 関連情報の発見 |
| ブログ投稿対応 | ページだけでなくブログ記事も取得 | 社内アナウンスやリリースノートの把握 |

## スペース情報取得のパターン詳細

「スペース情報取得」には複数のアプローチがある：

| パターン | 機能 | ユースケース |
|----------|------|-------------|
| スペース一覧 | 全スペースのリスト取得（名前、キー、説明） | 「どんなスペースがあるか」を把握 |
| スペース詳細 | 特定スペースのメタ情報（ホームページID、権限等） | スペースの起点を知る |
| スペース内ページ一覧 | スペース配下のページをフラットに一覧 | 「このスペースに何があるか」を把握 |
| スペースツリー取得 | スペース配下のページを階層構造で取得 | 構造を理解してナビゲート |

今回は「スペースツリー取得」を採用。ページ数が多いため、ツリー構造のみ（本文なし）を返す設計とした。

## LLMによるページ要約生成・保存（新規アイデア）

### 背景・課題

- Confluenceの `description` は手動設定が必要で、保守コストが高い
- 設定されていないページが多い
- 設定されていても内容と乖離している可能性

### 解決策

LLMでページ内容を認識し、要約を自動生成して保存する仕組み。

```
ページ取得 → LLMで要約生成 → 保存 → get_space_treeで参照
```

### 設計上の考慮事項

| 観点 | 選択肢 | 備考 |
|------|--------|------|
| **保存先** | Confluenceページプロパティ | Confluence内で完結、権限管理も既存のまま |
| | ローカルDB（SQLite等） | 高速アクセス、Confluenceへの書き込み不要 |
| | 外部ストレージ（S3等） | スケーラブル、永続化 |
| **更新タイミング** | ページ更新検知時 | リアルタイム性高いがWebhook等の仕組みが必要 |
| | 定期バッチ | シンプル、更新頻度で調整可能 |
| | 手動トリガー | オンデマンド、コスト最小 |
| **要約の長さ** | 1〜2文 | 一覧表示向け、コンパクト |
| | 数行 | 概要把握に十分 |
| | 箇条書き | 構造化された情報 |
| **コスト** | LLM呼び出しコスト | ページ数 × 更新頻度 で見積もり |

### ユースケース

- `get_space_tree` でツリー取得時、LLM生成の要約を `description` として返す
- タイトルだけでは判断できないページも、要約で内容を把握できる
- ページ更新時に要約を再生成し、常に最新の内容を反映

### ステータス

将来検討。`get_space_tree` 実装後に優先度を再評価。

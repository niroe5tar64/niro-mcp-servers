# タスク生成ルール

## コア原則

### 1. 自然言語の記述
コード構造ではなく、機能と成果に焦点を当てる。

**記述するもの**:
- 実現すべき機能
- ビジネスロジックと振る舞い
- フィーチャーと能力
- ドメイン言語と概念
- データ関係とワークフロー

**避けるもの**:
- ファイルパスやディレクトリ構造
- 関数/メソッド名やシグネチャ
- 型定義やインターフェース
- クラス名や API 契約
- 特定のデータ構造

**根拠**: 実装詳細（ファイル、メソッド、型）は design.md に定義する。タスクは実施すべき機能的作業を記述する。

### 2. タスクの統合と進行

**すべてのタスクが満たすべきこと**:
- 既存成果に基づく（孤立コードを作らない）
- 全体システムに接続（ぶら下がり機能を作らない）
- 段階的に進める（大きな飛躍をしない）
- 早期にコア機能を検証する
- design.md のアーキテクチャ境界（Architecture Pattern & Boundary Map）を尊重する
- design.md に記載されたインターフェース契約を遵守する
- 大タスクの要約は控えめに使い、子タスクで十分表現できる場合は詳細箇条書きを省く。

**最後は統合タスク**で締める。

### 3. 柔軟なタスクサイズ

**ガイドライン**:
- **大タスク**: 必要な数だけサブタスクを用意（凝集性でグループ化）
- **サブタスク**: 1-3 時間程度、詳細は 3-10 項目
- 粒度が細かすぎ/粗すぎにならないよう調整

**任意の数に合わせない** - 論理的なまとまりに従う。

### 4. 要件マッピング

**各タスク詳細の末尾に記載**:
- `_Requirements: X.X, Y.Y_` の形式で**数値の要件IDのみ**を列挙（カンマ区切り）。説明、括弧、翻訳、自由形式ラベルは付けない。
- 横断的要件は該当する ID をすべて列挙。requirements.md の要件は必ず数値 ID を持つ必要がある。ID がない場合はタスク生成前に修正する。
- 必要に応じて design.md のコンポーネント/契約を参照（例: `_Contracts: AuthService API`）

### 5. コード中心のフォーカス

**含めるもの**:
- コーディングタスク（実装）
- テストタスク（ユニット、統合、E2E）
- 技術的セットアップ（インフラ、設定）

**除外するもの**:
- デプロイタスク
- ドキュメント作成
- ユーザーテスト
- マーケティング/ビジネス活動

### 任意のテストカバレッジタスク

- 設計で機能カバレッジが担保され、MVP の迅速化が優先される場合、テスト専用の後回し作業（例: 基本描画/ユニットテスト）を `- [ ]*` で**任意**としてマークする。
- 任意マーカーは、サブタスクが requirements.md の受け入れ基準を詳細箇条書きで参照している場合にのみ使用する。
- 実装作業や統合に不可欠な検証は任意にしない。`*` は MVP 後の補助的テストに限定する。

## タスク階層ルール

### 最大 2 階層
- **レベル 1**: 大タスク（1, 2, 3, 4...）
- **レベル 2**: サブタスク（1.1, 1.2, 2.1, 2.2...）
- **それ以上は不可**（1.1.1 などは禁止）
- 大タスクが単一の実行項目しか持たない場合は階層を潰し、サブタスクを大タスクに昇格する（例: `1.1` を `1.` にする）。
- 大タスクがコンテナ目的のみの場合はチェックボックスの説明を簡潔にし、詳細はサブタスクに集約する。

### 連番のルール
- 大タスクは必ず連番: 1, 2, 3, 4, 5...
- サブタスクは大タスクごとにリセット: 1.1, 1.2 の後に 2.1, 2.2...
- 大タスク番号の重複は禁止

### 並列分析（デフォルト）
- `--sequential` が明示されない限り、並列分析は有効とみなす。
- 以下をすべて満たすタスクを並列実行可能と判定:
  - 他の未完タスクへのデータ依存がない
  - 共有ファイルやリソースの競合がない
  - 他タスクの事前レビュー/承認が不要
- Architecture Pattern & Boundary Map で定義された境界内で並列タスクが動くことを検証する。
- design.md の API/イベント契約が競合しないことを確認する。
- 並列可能タスクの番号直後に `(P)` を付ける:
  - 例: `- [ ] 2.1 (P) バックグラウンドワーカーを構築`
  - 大タスク/サブタスクの両方に適用可能
- 順次モード指定時は `(P)` を付けない。
- 並列タスクは論理的にグルーピングし、順序の注意点を詳細に記載する。
- 似たタスクでも `(P)` にできない場合は依存関係を明示する。

### チェックボックス形式
```markdown
- [ ] 1. 大タスクの説明
- [ ] 1.1 サブタスクの説明
  - 詳細項目 1
  - 詳細項目 2
  - _Requirements: X.X_

- [ ] 1.2 サブタスクの説明
  - 詳細項目...
  - _Requirements: Y.Y_

- [ ] 1.3 サブタスクの説明
  - 詳細項目...
  - _Requirements: Z.Z, W.W_

- [ ] 2. 次の大タスク（1 には戻らない！）
- [ ] 2.1 サブタスク...
```

## 要件カバレッジ

**必須チェック**:
- requirements.md の要件は**すべて**カバーすること
- すべての要件 ID をタスクに対応づけること
- 欠落がある場合: 要件または設計フェーズに戻る
- どの要件もタスクがない状態にしないこと

`N.M` 形式の数値要件 ID を使用する。`N` は requirements.md の上位要件番号（例: Requirement 1 → 1.1, 1.2; Requirement 2 → 2.1, 2.2）、`M` はその要件内のローカルインデックス。

意図的に延期する要件があれば、理由を記載する。

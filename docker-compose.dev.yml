version: '3.8'

services:
  # Dev Container for development with Claude Code
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile.dev
      target: development
    container_name: niro-mcp-devcontainer
    working_dir: /workspace
    command: sleep infinity
    volumes:
      # Mount source code
      - .:/workspace:cached
      # Persist Bun cache for faster installs
      - bun-cache:/home/bun/.bun
      # Persist git configuration
      - bun-config:/home/bun/.config
    environment:
      - NODE_ENV=development
      - TERM=xterm-256color
    networks:
      - niro-mcp-network
    # Keep container running for interactive development
    stdin_open: true
    tty: true

  # Confluence-Content MCP Server (can be started separately for testing)
  # Note: volumes (including packages/shared) are inherited from docker-compose.yml via extends
  confluence-content:
    extends:
      file: docker-compose.yml
      service: confluence-content
    # Override command for development mode with hot reload
    command: bun run dev
    # Enable HTTP transport for easier testing from DevContainer
    environment:
      - NODE_ENV=development
      - TRANSPORT_MODE=http
      - PORT=50302
      - HOST=0.0.0.0
    # Expose port for HTTP access
    ports:
      - "50302:50302"
    # Disable read-only for development
    read_only: false
    networks:
      - niro-mcp-network
    profiles:
      - mcp-servers

networks:
  niro-mcp-network:
    driver: bridge

volumes:
  bun-cache:
    driver: local
  bun-config:
    driver: local

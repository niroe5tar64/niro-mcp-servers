# Development Dockerfile for Dev Container
# This provides a safe, isolated environment for Claude Code with Dangerous Skip mode

FROM oven/bun:1 AS development

# Install development tools and utilities
RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    vim \
    nano \
    less \
    procps \
    net-tools \
    iputils-ping \
    sudo \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Set up sudo for bun user (useful for installing additional tools)
RUN echo "bun ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/bun \
    && chmod 0440 /etc/sudoers.d/bun

# Set working directory
WORKDIR /workspace

# Configure git to trust the workspace directory
RUN git config --global --add safe.directory /workspace

# Set up Bun environment
ENV BUN_INSTALL=/home/bun/.bun
ENV PATH=$BUN_INSTALL/bin:$PATH

# Switch to bun user
USER bun

# Set up shell
RUN echo 'export PS1="\[\033[01;32m\]\u@devcontainer\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ "' >> /home/bun/.bashrc

# Health check (optional)
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD bun --version || exit 1

# Default command - keep container running
CMD ["sleep", "infinity"]

# セキュリティ標準

[目的: 検証、認可、シークレット、データに関するパターンでセキュリティ姿勢を定義する]

## フィロソフィー
- 多層防御、最小権限、セキュアデフォルト、フェイルクローズ
- 境界で検証、文脈に応じてサニタイズ、入力は信用しない
- 認証（誰）と認可（何ができるか）を分離する

## 入出力
- API 境界と UI フォームで検証し、型と制約を強制する
- 行き先に応じてサニタイズ/エスケープ（HTML、SQL、シェル、ログ）
- ブロックリストより許可リストを優先し、最小限の詳細で早期拒否

## 認証と認可
- 認証: アイデンティティを検証し、短命トークン/セッションを発行
- 認可: 操作前に権限をチェックし、デフォルト拒否
- ポリシーを中央集約し、チェックの重複を避ける

パターン:
```typescript
if (!user.hasPermission('resource:action')) throw ForbiddenError();
```

## シークレット & 設定
- シークレットをコミットしない。シークレットマネージャや環境変数に保存
- 定期ローテーション、アクセス監査、最小スコープ
- 起動時に必須環境変数を検証し、欠落時は即失敗

## 機密データ
- 収集を最小化し、ログではマスク/伏字、保存時・転送時に暗号化
- 役割/必要性に応じたアクセス制御、機密レコードのアクセス追跡

## セッション/トークン安全性
- 可能な限り httpOnly + secure cookie、常時 TLS
- 有効期限は短く、リフレッシュ時にローテーション、ログアウト/漏えい時は失効
- トークンに audience/issuer を紐づけ、クレームは最小限

## ロギング（セキュリティ配慮）
- 認証試行、権限拒否、機密操作を記録
- パスワード/トークン/シークレット/完全な PII/リクエストボディ全文は記録しない
- requestId と文脈を含めて相関可能にする

## ヘッダー & 伝送
- TLS を強制、HSTS
- セキュリティヘッダを設定（CSP、X-Frame-Options、X-Content-Type-Options）
- 現代的な暗号を優先し、弱いプロトコル/暗号は無効化

## 脆弱性対応
- 安全なライブラリを優先し、依存関係は常に最新に保つ
- CI で静的/動的スキャンを実施し、追跡と修正を行う
- よくある脆弱性をチームに教育し、上記パターンとして明文化する

---
_パターンと原則に集中する。具体的な設定は運用ドキュメントにリンクする。_
